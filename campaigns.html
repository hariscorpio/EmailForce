<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaigns - EmailForce</title>
    <link rel="stylesheet" href="style.css">
    <!-- Quill.js for rich text editing -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container-fluid">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">E</div>
                    EmailForce
                </div>
                <nav class="nav">
                    <a href="dashboard.html" class="nav-link">Dashboard</a>
                    <a href="campaigns.html" class="nav-link active">Campaigns</a>
                    <a href="automations.html" class="nav-link">Automations</a>
                    <a href="analytics.html" class="nav-link">Analytics</a>
                </nav>
                <div class="user-menu">
                    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
                    <div class="user-avatar">M</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <nav class="sidebar-nav">
            <div class="sidebar-section">
                <div class="sidebar-title">Overview</div>
                <a href="dashboard.html" class="sidebar-link">
                    <span class="sidebar-icon">üìä</span>
                    Dashboard
                </a>
                <a href="analytics.html" class="sidebar-link">
                    <span class="sidebar-icon">üìà</span>
                    Analytics
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Campaigns</div>
                <a href="campaigns.html" class="sidebar-link active">
                    <span class="sidebar-icon">üìß</span>
                    Campaign Builder
                </a>
                <a href="campaigns.html#templates" class="sidebar-link">
                    <span class="sidebar-icon">üìã</span>
                    Templates
                </a>
                <a href="campaigns.html#drafts" class="sidebar-link">
                    <span class="sidebar-icon">üìù</span>
                    Drafts
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Automations</div>
                <a href="automations.html" class="sidebar-link">
                    <span class="sidebar-icon">ü§ñ</span>
                    AI Agents
                </a>
                <a href="automations.html#recovery" class="sidebar-link">
                    <span class="sidebar-icon">üí∞</span>
                    Revenue Recovery
                </a>
                <a href="automations.html#workflows" class="sidebar-link">
                    <span class="sidebar-icon">‚ö°</span>
                    Workflows
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Compliance</div>
                <a href="compliance-guard.html" class="sidebar-link">
                    <span class="sidebar-icon">üõ°Ô∏è</span>
                    Compliance Guard
                </a>
                <a href="compliance-guard.html#consent" class="sidebar-link">
                    <span class="sidebar-icon">‚úÖ</span>
                    Consent Management
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Settings</div>
                <a href="integrations.html" class="sidebar-link">
                    <span class="sidebar-icon">üîó</span>
                    Integrations
                </a>
                <a href="#" class="sidebar-link">
                    <span class="sidebar-icon">üë•</span>
                    Team
                </a>
                <a href="#" class="sidebar-link">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    Settings
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Campaign Builder</h1>
            <p class="page-subtitle">Create AI-powered email campaigns with dynamic content and hyper-personalization.</p>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-8">
            <div class="card-header">
                <h3 class="card-title">Quick Actions</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-4">
                    <button class="btn btn-primary" onclick="showAICampaignModal()">
                        <span>ü§ñ</span>
                        AI Campaign
                    </button>
                    <button class="btn btn-secondary" onclick="showTemplateModal()">
                        <span>üìã</span>
                        Use Template
                    </button>
                    <button class="btn btn-secondary" onclick="showCDPModal()">
                        <span>üîó</span>
                        CDP Campaign
                    </button>
                    <button class="btn btn-secondary" onclick="showImportModal()">
                        <span>üì•</span>
                        Import Campaign
                    </button>
                </div>
            </div>
        </div>

        <!-- Campaign Builder -->
        <div class="campaign-builder">
            <div class="grid grid-2" style="gap: 0;">
                <!-- Campaign Sidebar -->
                <div class="campaign-sidebar">
                    <h3 style="margin-bottom: var(--spacing-6);">Campaign Settings</h3>
                    
                    <!-- Campaign Info -->
                    <div class="form-group">
                        <label class="form-label" for="campaignName">Campaign Name</label>
                        <input type="text" id="campaignName" class="form-input" placeholder="e.g., Summer Sale 2024" value="Summer Sale - 25% Off">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="campaignSubject">Subject Line</label>
                        <input type="text" id="campaignSubject" class="form-input" placeholder="Enter subject line" value="üî• Summer Sale: 25% Off Everything!">
                        <div style="margin-top: var(--spacing-2);">
                            <button class="btn btn-sm btn-secondary" onclick="generateSubjectLine()">ü§ñ AI Generate</button>
                            <button class="btn btn-sm btn-secondary" onclick="showABTestModal()">A/B Test</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="campaignPreview">Preview Text</label>
                        <input type="text" id="campaignPreview" class="form-input" placeholder="Preview text shown in email clients" value="Don't miss out on our biggest sale of the year!">
                    </div>

                    <!-- Audience Selection -->
                    <div class="form-group">
                        <label class="form-label">Audience</label>
                        <select class="form-select" id="audienceSelect">
                            <option value="all">All Subscribers (2,341)</option>
                            <option value="active">Active Subscribers (1,847)</option>
                            <option value="inactive">Inactive Subscribers (456)</option>
                            <option value="high-value">High-Value Customers (234)</option>
                            <option value="new">New Subscribers (89)</option>
                            <option value="cdp">CDP Segments</option>
                        </select>
                        <button class="btn btn-sm btn-secondary" style="margin-top: var(--spacing-2);" onclick="showAudienceModal()">Manage Audiences</button>
                    </div>

                    <!-- CDP Integration -->
                    <div class="form-group" id="cdpSection" style="display: none;">
                        <label class="form-label">CDP Segments</label>
                        <div style="background: var(--gray-50); padding: var(--spacing-3); border-radius: var(--radius-md); margin-bottom: var(--spacing-3);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2);">
                                <span style="font-weight: 500;">High-Value Customers - At Risk</span>
                                <span class="badge badge-warning">1,234 contacts</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2);">
                                <span style="font-weight: 500;">Recent Purchasers</span>
                                <span class="badge badge-success">567 contacts</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 500;">Cart Abandoners</span>
                                <span class="badge badge-info">89 contacts</span>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="showCDPSegmentsModal()">Select Segments</button>
                    </div>

                    <!-- Send Settings -->
                    <div class="form-group">
                        <label class="form-label">Send Time</label>
                        <select class="form-select">
                            <option value="now">Send Now</option>
                            <option value="scheduled">Schedule for Later</option>
                            <option value="optimized" selected>AI Optimized Time</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Time Zone</label>
                        <select class="form-select">
                            <option value="pst">Pacific Time (PST)</option>
                            <option value="mst">Mountain Time (MST)</option>
                            <option value="cst">Central Time (CST)</option>
                            <option value="est" selected>Eastern Time (EST)</option>
                        </select>
                    </div>

                    <!-- Campaign Actions -->
                    <div style="margin-top: var(--spacing-8);">
                        <button class="btn btn-primary w-full" onclick="previewCampaign()">Preview Campaign</button>
                        <button class="btn btn-secondary w-full" style="margin-top: var(--spacing-3);" onclick="saveDraft()">Save as Draft</button>
                        <button class="btn btn-success w-full" style="margin-top: var(--spacing-3);" onclick="sendCampaign()">Send Campaign</button>
                    </div>
                </div>

                <!-- Campaign Canvas -->
                <div class="campaign-canvas">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-6);">
                        <h3>Email Content</h3>
                        <div>
                            <button class="btn btn-sm btn-secondary" onclick="showContentBlocksModal()">Add Content Block</button>
                            <button class="btn btn-sm btn-secondary" onclick="showAIGenerateModal()">ü§ñ AI Generate</button>
                        </div>
                    </div>

                    <!-- Rich Text Editor -->
                    <div class="rich-text-editor">
                        <div id="emailContentEditor">
                            <div style="text-align: center; margin-bottom: var(--spacing-6);">
                                <h2 style="color: var(--primary-blue); margin-bottom: var(--spacing-2);">üî• Summer Sale</h2>
                                <h1 style="font-size: var(--font-size-3xl); margin-bottom: var(--spacing-4);">25% OFF EVERYTHING</h1>
                                <p style="font-size: var(--font-size-lg); color: var(--gray-600); margin-bottom: var(--spacing-6);">Limited time offer - Don't miss out on our biggest sale of the year!</p>
                                <button class="btn btn-lg" style="background: var(--accent-green); color: white; font-size: var(--font-size-lg);">SHOP NOW</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-4); margin-bottom: var(--spacing-6);">
                                <div style="text-align: center;">
                                    <div style="width: 100px; height: 100px; background: var(--gray-200); border-radius: var(--radius-md); margin: 0 auto var(--spacing-3); display: flex; align-items: center; justify-content: center; color: var(--gray-500);">üëü</div>
                                    <h4>Running Shoes</h4>
                                    <p style="color: var(--gray-600);">Up to 40% off</p>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 100px; height: 100px; background: var(--gray-200); border-radius: var(--radius-md); margin: 0 auto var(--spacing-3); display: flex; align-items: center; justify-content: center; color: var(--gray-500);">üëï</div>
                                    <h4>Activewear</h4>
                                    <p style="color: var(--gray-600);">Up to 35% off</p>
                                </div>
                            </div>

                            <div style="text-align: center; padding: var(--spacing-6); background: var(--gray-50); border-radius: var(--radius-md);">
                                <h3 style="margin-bottom: var(--spacing-3);">üéâ Flash Sale Alert!</h3>
                                <p style="margin-bottom: var(--spacing-4);">This offer expires in 24 hours. Shop now to secure your discount!</p>
                                <button class="btn btn-primary">CLAIM YOUR DISCOUNT</button>
                            </div>
                        </div>
                    </div>

                    <!-- Editor Actions -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-4);">
                        <div class="btn-group">
                            <button class="btn btn-sm btn-secondary" onclick="saveTemplate()">üíæ Save Template</button>
                            <button class="btn btn-sm btn-secondary" onclick="showTemplateLibrary()">üìö Templates</button>
                            <button class="btn btn-sm btn-secondary" onclick="showABTestModal()">A/B Test</button>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-secondary" onclick="previewEmail()">üëÅÔ∏è Preview</button>
                            <button class="btn btn-sm btn-primary" onclick="showAnalytics()">üìä Analytics</button>
                        </div>
                    </div>

                    <!-- Content Blocks -->
                    <div>
                        <h4 style="margin-bottom: var(--spacing-4);">Content Blocks</h4>
                        <div class="content-block">
                            <span>+ Add Hero Section</span>
                        </div>
                        <div class="content-block">
                            <span>+ Add Product Grid</span>
                        </div>
                        <div class="content-block dynamic">
                            <span>+ Add Dynamic Content Block</span>
                        </div>
                        <div class="content-block">
                            <span>+ Add CTA Section</span>
                        </div>
                        <div class="content-block">
                            <span>+ Add Footer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Campaigns -->
        <div class="card mt-8">
            <div class="card-header">
                <h3 class="card-title">Recent Campaigns</h3>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Campaign Name</th>
                            <th>Status</th>
                            <th>Audience</th>
                            <th>Sent</th>
                            <th>Open Rate</th>
                            <th>Click Rate</th>
                            <th>Revenue</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Summer Sale - 25% Off</td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td>All Subscribers</td>
                            <td>2,341</td>
                            <td>24.7%</td>
                            <td>8.9%</td>
                            <td>$3,247</td>
                            <td>
                                <button class="btn btn-sm btn-secondary">View</button>
                                <button class="btn btn-sm btn-primary">Duplicate</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Welcome Series - Day 1</td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td>New Subscribers</td>
                            <td>89</td>
                            <td>34.2%</td>
                            <td>12.1%</td>
                            <td>$234</td>
                            <td>
                                <button class="btn btn-sm btn-secondary">View</button>
                                <button class="btn btn-sm btn-primary">Duplicate</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Product Launch - New Collection</td>
                            <td><span class="badge badge-info">Draft</span></td>
                            <td>High-Value Customers</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>
                                <button class="btn btn-sm btn-primary">Edit</button>
                                <button class="btn btn-sm btn-success">Send</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- AI Campaign Modal -->
    <div id="aiCampaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create AI-Powered Campaign</h3>
                <button class="modal-close" onclick="hideAICampaignModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="aiCampaignForm">
                    <div class="form-group">
                        <label class="form-label" for="aiPrompt">Describe your campaign</label>
                        <textarea id="aiPrompt" class="form-textarea" placeholder="e.g., Create a 24-hour flash sale email for 25% off all shoes with urgency messaging and product recommendations" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="aiTone">Tone of Voice</label>
                        <select id="aiTone" class="form-select" required>
                            <option value="professional">Professional</option>
                            <option value="casual" selected>Casual & Friendly</option>
                            <option value="urgent">Urgent & Exciting</option>
                            <option value="luxury">Luxury & Premium</option>
                            <option value="humorous">Humorous & Playful</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="aiLength">Email Length</label>
                        <select id="aiLength" class="form-select" required>
                            <option value="short">Short & Concise</option>
                            <option value="medium" selected>Medium</option>
                            <option value="long">Long & Detailed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="aiPersonalization">Personalization Level</label>
                        <select id="aiPersonalization" class="form-select" required>
                            <option value="basic">Basic (Name only)</option>
                            <option value="standard" selected>Standard (Name + preferences)</option>
                            <option value="advanced">Advanced (Full personalization)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideAICampaignModal()">Cancel</button>
                <button class="btn btn-primary" onclick="generateAICampaign()">Generate Campaign</button>
            </div>
        </div>
    </div>

    <!-- CDP Segments Modal -->
    <div id="cdpSegmentsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Select CDP Segments</h3>
                <button class="modal-close" onclick="hideCDPSegmentsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: var(--spacing-4);">
                    <input type="text" class="form-input" placeholder="Search segments..." style="margin-bottom: var(--spacing-4);">
                </div>
                <div style="max-height: 400px; overflow-y: auto;">
                    <div style="border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: var(--spacing-4); margin-bottom: var(--spacing-3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2);">
                            <label style="display: flex; align-items: center; gap: var(--spacing-2);">
                                <input type="checkbox" checked>
                                <span style="font-weight: 500;">High-Value Customers - At Risk</span>
                            </label>
                            <span class="badge badge-warning">1,234 contacts</span>
                        </div>
                        <p style="color: var(--gray-600); font-size: var(--font-size-sm);">Customers with high lifetime value who haven't purchased in 30+ days</p>
                    </div>
                    <div style="border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: var(--spacing-4); margin-bottom: var(--spacing-3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2);">
                            <label style="display: flex; align-items: center; gap: var(--spacing-2);">
                                <input type="checkbox" checked>
                                <span style="font-weight: 500;">Recent Purchasers</span>
                            </label>
                            <span class="badge badge-success">567 contacts</span>
                        </div>
                        <p style="color: var(--gray-600); font-size: var(--font-size-sm);">Customers who made a purchase in the last 7 days</p>
                    </div>
                    <div style="border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: var(--spacing-4); margin-bottom: var(--spacing-3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-2);">
                            <label style="display: flex; align-items: center; gap: var(--spacing-2);">
                                <input type="checkbox">
                                <span style="font-weight: 500;">Cart Abandoners</span>
                            </label>
                            <span class="badge badge-info">89 contacts</span>
                        </div>
                        <p style="color: var(--gray-600); font-size: var(--font-size-sm);">Customers who abandoned their cart in the last 24 hours</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideCDPSegmentsModal()">Cancel</button>
                <button class="btn btn-primary" onclick="applyCDPSegments()">Apply Segments</button>
            </div>
        </div>
    </div>

    <!-- Template Library Modal -->
    <div id="templateLibraryModal" class="modal">
        <div class="modal-content template-modal">
            <div class="modal-header">
                <h3 class="modal-title">üìö Template Library</h3>
                <button class="modal-close" onclick="hideTemplateLibrary()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchTab('saved-templates')">Saved Templates</button>
                    <button class="modal-tab" onclick="switchTab('premium-templates')">Premium Templates</button>
                    <button class="modal-tab" onclick="switchTab('ai-templates')">AI Generated</button>
                </div>
                
                <div id="saved-templates" class="modal-tab-content active">
                    <div id="templateList">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>
                
                <div id="premium-templates" class="modal-tab-content">
                    <div class="template-item">
                        <div class="template-info">
                            <h4>üé® Modern Newsletter</h4>
                            <p>Professional newsletter template with modern design</p>
                            <small>Premium Template</small>
                        </div>
                        <div class="template-actions">
                            <button class="btn btn-sm btn-primary">Use Template</button>
                            <button class="btn btn-sm btn-secondary">Preview</button>
                        </div>
                    </div>
                    <div class="template-item">
                        <div class="template-info">
                            <h4>üî• Flash Sale</h4>
                            <p>High-converting flash sale template</p>
                            <small>Premium Template</small>
                        </div>
                        <div class="template-actions">
                            <button class="btn btn-sm btn-primary">Use Template</button>
                            <button class="btn btn-sm btn-secondary">Preview</button>
                        </div>
                    </div>
                </div>
                
                <div id="ai-templates" class="modal-tab-content">
                    <div class="template-item">
                        <div class="template-info">
                            <h4>ü§ñ AI Generated - Product Launch</h4>
                            <p>Generated for your product launch campaign</p>
                            <small>Generated 2 hours ago</small>
                        </div>
                        <div class="template-actions">
                            <button class="btn btn-sm btn-primary">Use Template</button>
                            <button class="btn btn-sm btn-secondary">Regenerate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- A/B Testing Modal -->
    <div id="abTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üß™ A/B Testing</h3>
                <button class="modal-close" onclick="hideABTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchABTab('create-test')">Create Test</button>
                    <button class="modal-tab" onclick="switchABTab('active-tests')">Active Tests</button>
                    <button class="modal-tab" onclick="switchABTab('test-results')">Results</button>
                </div>
                
                <div id="create-test" class="modal-tab-content active">
                    <form id="abTestForm">
                        <div class="form-group">
                            <label class="form-label">Test Name</label>
                            <input type="text" class="form-input" placeholder="e.g., Subject Line Test - Summer Sale">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Test Type</label>
                            <select class="form-select">
                                <option value="subject">Subject Line</option>
                                <option value="content">Email Content</option>
                                <option value="send-time">Send Time</option>
                                <option value="sender">Sender Name</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Variant A</label>
                            <input type="text" class="form-input" placeholder="Enter first variant">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Variant B</label>
                            <input type="text" class="form-input" placeholder="Enter second variant">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Split Percentage</label>
                            <select class="form-select">
                                <option value="50">50/50 Split</option>
                                <option value="60">60/40 Split</option>
                                <option value="70">70/30 Split</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Test Duration</label>
                            <select class="form-select">
                                <option value="24">24 hours</option>
                                <option value="48">48 hours</option>
                                <option value="72">72 hours</option>
                                <option value="168">1 week</option>
                            </select>
                        </div>
                    </form>
                </div>
                
                <div id="active-tests" class="modal-tab-content">
                    <div id="abTestList">
                        <!-- Active A/B tests will be loaded here -->
                    </div>
                </div>
                
                <div id="test-results" class="modal-tab-content">
                    <div class="ab-test-results">
                        <div class="ab-test-variant">
                            <h4>Variant A</h4>
                            <div class="ab-test-metrics">
                                <div class="ab-test-metric">
                                    <div class="ab-test-metric-value">24.7%</div>
                                    <div class="ab-test-metric-label">Open Rate</div>
                                </div>
                                <div class="ab-test-metric">
                                    <div class="ab-test-metric-value">8.9%</div>
                                    <div class="ab-test-metric-label">Click Rate</div>
                                </div>
                            </div>
                        </div>
                        <div class="ab-test-variant winner">
                            <h4>Variant B (Winner)</h4>
                            <div class="ab-test-metrics">
                                <div class="ab-test-metric">
                                    <div class="ab-test-metric-value">28.3%</div>
                                    <div class="ab-test-metric-label">Open Rate</div>
                                </div>
                                <div class="ab-test-metric">
                                    <div class="ab-test-metric-value">12.1%</div>
                                    <div class="ab-test-metric-label">Click Rate</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideABTestModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createABTest()">Create A/B Test</button>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìä AI Analytics Dashboard</h3>
                <button class="modal-close" onclick="hideAnalytics()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <span class="analytics-card-title">Total Generations</span>
                            <div class="analytics-card-icon" style="background: var(--primary-blue); color: white;">ü§ñ</div>
                        </div>
                        <div class="analytics-card-value" id="totalGenerations">0</div>
                        <div class="analytics-card-change positive">
                            <span>‚ÜóÔ∏è +12%</span>
                            <span>vs last week</span>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <span class="analytics-card-title">Success Rate</span>
                            <div class="analytics-card-icon" style="background: var(--success); color: white;">‚úÖ</div>
                        </div>
                        <div class="analytics-card-value" id="successRate">0%</div>
                        <div class="analytics-card-change positive">
                            <span>‚ÜóÔ∏è +5%</span>
                            <span>vs last week</span>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <span class="analytics-card-title">Avg Generation Time</span>
                            <div class="analytics-card-icon" style="background: var(--warning); color: white;">‚è±Ô∏è</div>
                        </div>
                        <div class="analytics-card-value" id="avgGenerationTime">0s</div>
                        <div class="analytics-card-change negative">
                            <span>‚ÜòÔ∏è +2s</span>
                            <span>vs last week</span>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <span class="analytics-card-title">Content Quality Score</span>
                            <div class="analytics-card-icon" style="background: var(--accent-purple); color: white;">‚≠ê</div>
                        </div>
                        <div class="analytics-card-value" id="qualityScore">0/10</div>
                        <div class="analytics-card-change positive">
                            <span>‚ÜóÔ∏è +0.5</span>
                            <span>vs last week</span>
                        </div>
                    </div>
                </div>
                
                <div class="analytics-chart">
                    <div class="analytics-chart-header">
                        <h4 class="analytics-chart-title">Content Type Breakdown</h4>
                        <div class="analytics-chart-controls">
                            <button class="btn btn-sm btn-secondary">Last 7 days</button>
                            <button class="btn btn-sm btn-secondary">Last 30 days</button>
                        </div>
                    </div>
                    <div id="contentTypeBreakdown" class="content-type-breakdown">
                        <!-- Content type breakdown will be loaded here -->
                    </div>
                </div>
                
                <div class="analytics-chart">
                    <div class="analytics-chart-header">
                        <h4 class="analytics-chart-title">Generation Performance Over Time</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="ai-integration.js"></script>
    <script>
        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
            }
        }

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.setAttribute('data-theme', savedTheme);
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // Save theme preference
        document.querySelector('.theme-toggle').addEventListener('click', function() {
            const currentTheme = document.body.getAttribute('data-theme');
            localStorage.setItem('theme', currentTheme === 'dark' ? '' : 'dark');
        });

        // Audience selection
        document.getElementById('audienceSelect').addEventListener('change', function() {
            const cdpSection = document.getElementById('cdpSection');
            if (this.value === 'cdp') {
                cdpSection.style.display = 'block';
            } else {
                cdpSection.style.display = 'none';
            }
        });

        // Modal functions
        function showAICampaignModal() {
            document.getElementById('aiCampaignModal').classList.add('show');
        }

        function hideAICampaignModal() {
            document.getElementById('aiCampaignModal').classList.remove('show');
        }

        function showCDPSegmentsModal() {
            document.getElementById('cdpSegmentsModal').classList.add('show');
        }

        function hideCDPSegmentsModal() {
            document.getElementById('cdpSegmentsModal').classList.remove('show');
        }

        function showTemplateModal() {
            alert('Template library will be available in the next update.');
        }

        function showCDPModal() {
            alert('CDP campaign creation requires integration setup. Please visit the Integrations page.');
        }

        function showImportModal() {
            alert('Campaign import feature will be available in the next update.');
        }

        function showAudienceModal() {
            alert('Audience management will be available in the next update.');
        }

        function showContentBlocksModal() {
            alert('Content block library will be available in the next update.');
        }

        function showAIGenerateModal() {
            // Create AI content generation modal
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3 class="modal-title">ü§ñ AI Email Content Generator</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="aiContentForm">
                            <div class="form-group">
                                <label class="form-label">Campaign Type</label>
                                <select id="aiCampaignType" class="form-select" required>
                                    <option value="">Select campaign type...</option>
                                    <option value="sale">Sale/Promotion</option>
                                    <option value="newsletter">Newsletter</option>
                                    <option value="product-launch">Product Launch</option>
                                    <option value="abandoned-cart">Abandoned Cart</option>
                                    <option value="welcome">Welcome Series</option>
                                    <option value="re-engagement">Re-engagement</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Campaign Goal</label>
                                <select id="aiCampaignGoal" class="form-select" required>
                                    <option value="">Select primary goal...</option>
                                    <option value="sales">Drive Sales</option>
                                    <option value="engagement">Increase Engagement</option>
                                    <option value="awareness">Brand Awareness</option>
                                    <option value="conversion">Lead Conversion</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Target Audience</label>
                                <select id="aiTargetAudience" class="form-select" required>
                                    <option value="">Select audience...</option>
                                    <option value="all">All Subscribers</option>
                                    <option value="new">New Subscribers</option>
                                    <option value="active">Active Customers</option>
                                    <option value="inactive">Inactive Customers</option>
                                    <option value="high-value">High-Value Customers</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tone of Voice</label>
                                <select id="aiTone" class="form-select" required>
                                    <option value="professional">Professional</option>
                                    <option value="casual" selected>Casual & Friendly</option>
                                    <option value="urgent">Urgent & Exciting</option>
                                    <option value="luxury">Luxury & Premium</option>
                                    <option value="humorous">Humorous & Playful</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Key Message/Offer</label>
                                <textarea id="aiKeyMessage" class="form-textarea" placeholder="Describe your main offer, message, or what you want to communicate..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Call-to-Action</label>
                                <input type="text" id="aiCTA" class="form-input" placeholder="e.g., Shop Now, Learn More, Get Started" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Additional Context (Optional)</label>
                                <textarea id="aiContext" class="form-textarea" placeholder="Any additional details, brand guidelines, or specific requirements..."></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="btn btn-primary" onclick="generateAIEmailContent()">ü§ñ Generate Email Content</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function generateAICampaign() {
            const prompt = document.getElementById('aiPrompt').value;
            if (prompt) {
                alert('AI campaign generation started! This may take a few moments...');
                hideAICampaignModal();
                document.getElementById('aiCampaignForm').reset();
            } else {
                alert('Please describe your campaign first.');
            }
        }

        function applyCDPSegments() {
            alert('CDP segments applied successfully!');
            hideCDPSegmentsModal();
        }

        function previewCampaign() {
            alert('Campaign preview will open in a new window.');
        }

        function saveDraft() {
            alert('Campaign saved as draft successfully!');
        }

        function sendCampaign() {
            const campaignName = document.getElementById('campaignName').value;
            const audience = document.getElementById('audienceSelect').value;
            
            if (campaignName && audience) {
                if (confirm(`Are you sure you want to send "${campaignName}" to ${audience}?`)) {
                    alert('Campaign scheduled for sending!');
                }
            } else {
                alert('Please fill in all required fields before sending.');
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // AI Content Generation Functions
        function generateSubjectLine() {
            const campaignName = document.getElementById('campaignName').value;
            const currentSubject = document.getElementById('campaignSubject').value;
            
            // Get context from the campaign
            const context = {
                campaignName: campaignName,
                currentSubject: currentSubject,
                audience: document.getElementById('audienceSelect').value
            };
            
            // Generate AI subject line based on context
            const aiGeneratedSubjects = generateAISubjectLines(context);
            
            // Show subject line options modal
            showSubjectLineOptionsModal(aiGeneratedSubjects);
        }

        function generateAISubjectLines(context) {
            // This would typically call an AI API, but for demo purposes we'll generate variations
            const baseSubjects = [
                "üî• Don't Miss Our Biggest Sale of the Year!",
                "‚ö° 25% Off Everything - Limited Time Only!",
                "üéâ Summer Sale Alert: Massive Discounts Inside",
                "üí• Flash Sale: 25% Off All Products Today!",
                "üöÄ Your Exclusive Summer Sale is Here!",
                "üéÅ Special Discount Inside - Act Fast!",
                "‚ö° Limited Time: 25% Off Your Favorites",
                "üî• Hot Deal Alert: Don't Wait!",
                "üéÅ Special Discount Inside - Act Fast!",
                "üíé Premium Access: Exclusive Sale Now Live!"
            ];
            
            // Add personalization based on audience
            if (context.audience === 'high-value') {
                baseSubjects.push("üíé VIP Access: Your Exclusive Sale is Here!");
                baseSubjects.push("üéØ Premium Offer: Just for Our Best Customers!");
            }
            
            return baseSubjects.slice(0, 5); // Return top 5 options
        }

        function showSubjectLineOptionsModal(subjects) {
            // Create modal for subject line selection
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Choose AI-Generated Subject Line</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p style="margin-bottom: var(--spacing-4);">Select one of the AI-generated subject lines or create your own:</p>
                        <div id="subjectLineOptions">
                            ${subjects.map((subject, index) => `
                                <div class="subject-line-option" onclick="selectSubjectLine('${subject}')">
                                    <input type="radio" name="subjectLine" id="subject${index}" value="${subject}">
                                    <label for="subject${index}">${subject}</label>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: var(--spacing-4);">
                            <input type="text" id="customSubjectLine" class="form-input" placeholder="Or enter your own subject line...">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="btn btn-primary" onclick="applySelectedSubjectLine()">Apply Subject Line</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function selectSubjectLine(subject) {
            document.getElementById('customSubjectLine').value = subject;
        }

        function applySelectedSubjectLine() {
            const selectedSubject = document.getElementById('customSubjectLine').value;
            if (selectedSubject) {
                document.getElementById('campaignSubject').value = selectedSubject;
                document.querySelector('.modal').remove();
            } else {
                alert('Please select or enter a subject line.');
            }
        }

        function generateAIEmailContent() {
            const form = document.getElementById('aiContentForm');
            const formData = new FormData(form);
            
            // Get all form values
            const campaignType = document.getElementById('aiCampaignType').value;
            const campaignGoal = document.getElementById('aiCampaignGoal').value;
            const targetAudience = document.getElementById('aiTargetAudience').value;
            const tone = document.getElementById('aiTone').value;
            const keyMessage = document.getElementById('aiKeyMessage').value;
            const cta = document.getElementById('aiCTA').value;
            const context = document.getElementById('aiContext').value;
            
            if (!campaignType || !campaignGoal || !targetAudience || !keyMessage || !cta) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Show loading state
            const generateBtn = document.querySelector('.modal-footer .btn-primary');
            const originalText = generateBtn.textContent;
            generateBtn.textContent = 'ü§ñ Generating...';
            generateBtn.disabled = true;
            
            // Simulate AI generation (in real implementation, this would call an AI API)
            setTimeout(() => {
                const generatedContent = generateEmailContent({
                    campaignType,
                    campaignGoal,
                    targetAudience,
                    tone,
                    keyMessage,
                    cta,
                    context
                });
                
                showGeneratedContentModal(generatedContent);
                generateBtn.textContent = originalText;
                generateBtn.disabled = false;
                document.querySelector('.modal').remove();
            }, 2000);
        }

        function generateEmailContent(params) {
            // This is a simplified AI content generator
            // In a real implementation, this would call an AI API like OpenAI, Claude, etc.
            
            const templates = {
                sale: {
                    subject: `üî• ${params.keyMessage} - Limited Time Only!`,
                    hero: {
                        title: params.keyMessage.toUpperCase(),
                        subtitle: "Don't miss out on this amazing offer!",
                        cta: params.cta
                    },
                    content: [
                        {
                            type: 'text',
                            content: `Hey there! üëã We're excited to bring you ${params.keyMessage.toLowerCase()}. This is your chance to grab amazing deals before they're gone!`
                        },
                        {
                            type: 'featured',
                            title: "Why You'll Love This Offer",
                            items: [
                                "Exclusive discounts just for you",
                                "Limited time availability",
                                "Premium quality products",
                                "Fast and free shipping"
                            ]
                        },
                        {
                            type: 'urgency',
                            content: "‚è∞ This offer expires soon! Don't wait - act now to secure your discount."
                        }
                    ]
                },
                newsletter: {
                    subject: ` Your Weekly Update: ${params.keyMessage}`,
                    hero: {
                        title: "Your Weekly Newsletter",
                        subtitle: params.keyMessage,
                        cta: params.cta
                    },
                    content: [
                        {
                            type: 'text',
                            content: `Hello! Here's what's new and exciting this week. ${params.keyMessage}`
                        },
                        {
                            type: 'featured',
                            title: "This Week's Highlights",
                            items: [
                                "Latest product updates",
                                "Industry insights",
                                "Customer success stories",
                                "Upcoming events"
                            ]
                        }
                    ]
                },
                'product-launch': {
                    subject: `üöÄ Introducing: ${params.keyMessage}`,
                    hero: {
                        title: "NEW PRODUCT LAUNCH",
                        subtitle: params.keyMessage,
                        cta: params.cta
                    },
                    content: [
                        {
                            type: 'text',
                            content: `We're thrilled to announce our newest product! ${params.keyMessage} is here and it's everything you've been waiting for.`
                        },
                        {
                            type: 'featured',
                            title: "What Makes It Special",
                            items: [
                                "Innovative features",
                                "Premium quality",
                                "Exclusive early access",
                                "Special launch pricing"
                            ]
                        }
                    ]
                }
            };
            
            return templates[params.campaignType] || templates.sale;
        }

        function showGeneratedContentModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3 class="modal-title">ü§ñ Generated Email Content</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom: var(--spacing-4);">
                            <label class="form-label">Subject Line</label>
                            <input type="text" id="generatedSubject" class="form-input" value="${content.subject}">
                        </div>
                        
                        <div style="margin-bottom: var(--spacing-4);">
                            <label class="form-label">Preview</label>
                            <div style="background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: var(--radius-md); padding: var(--spacing-4);">
                                <h2 style="color: var(--primary-blue); margin-bottom: var(--spacing-2);">${content.hero.title}</h2>
                                <p style="font-size: var(--font-size-lg); color: var(--gray-600); margin-bottom: var(--spacing-4);">${content.hero.subtitle}</p>
                                <button class="btn btn-primary">${content.hero.cta}</button>
                                
                                ${content.content.map(block => {
                                    if (block.type === 'text') {
                                        return `<p style="margin: var(--spacing-4) 0;">${block.content}</p>`;
                                    } else if (block.type === 'featured') {
                                        return `
                                            <div style="margin: var(--spacing-4) 0;">
                                                <h4 style="margin-bottom: var(--spacing-2);">${block.title}</h4>
                                                <ul style="margin-left: var(--spacing-4);">
                                                    ${block.items.map(item => `<li>${item}</li>`).join('')}
                                                </ul>
                                            </div>
                                        `;
                                    } else if (block.type === 'urgency') {
                                        return `<p style="background: var(--accent-yellow); padding: var(--spacing-3); border-radius: var(--radius-md); margin: var(--spacing-4) 0;">${block.content}</p>`;
                                    }
                                }).join('')}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: var(--spacing-3);">
                            <button class="btn btn-secondary" onclick="regenerateContent()"> Regenerate</button>
                            <button class="btn btn-secondary" onclick="editContent()">‚úèÔ∏è Edit Content</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="btn btn-primary" onclick="applyGeneratedContent()">Apply to Campaign</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function applyGeneratedContent() {
            const subject = document.getElementById('generatedSubject').value;
            
            // Apply the generated content to the campaign
            document.getElementById('campaignSubject').value = subject;
            
            // Update the email preview (this would be more sophisticated in a real implementation)
            const emailPreview = document.querySelector('.campaign-canvas .email-preview');
            if (emailPreview) {
                // Update the preview content
                alert('Generated content has been applied to your campaign!');
            }
            
            document.querySelector('.modal').remove();
        }

        function regenerateContent() {
            // Close current modal and regenerate
            document.querySelector('.modal').remove();
            generateAIEmailContent();
        }

        function editContent() {
            alert('Content editor will be available in the next update.');
        }

        // Enhanced Modal Functions
        function showTemplateLibrary() {
            document.getElementById('templateLibraryModal').classList.add('show');
            emailForceAI.updateTemplateList();
        }

        function hideTemplateLibrary() {
            document.getElementById('templateLibraryModal').classList.remove('show');
        }

        function showABTestModal() {
            document.getElementById('abTestModal').classList.add('show');
            emailForceAI.updateABTestList();
        }

        function hideABTestModal() {
            document.getElementById('abTestModal').classList.remove('show');
        }

        function showAnalytics() {
            document.getElementById('analyticsModal').classList.add('show');
            updateAnalyticsDashboard();
        }

        function hideAnalytics() {
            document.getElementById('analyticsModal').classList.remove('show');
        }

        // Tab Switching Functions
        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.modal-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function switchABTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('#abTestModal .modal-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('#abTestModal .modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Analytics Functions
        function updateAnalyticsDashboard() {
            const summary = emailForceAI.getAnalyticsSummary();
            
            document.getElementById('totalGenerations').textContent = summary.totalGenerations;
            document.getElementById('successRate').textContent = summary.successRate.toFixed(1) + '%';
            document.getElementById('avgGenerationTime').textContent = Math.round(summary.averageGenerationTime / 1000) + 's';
            
            // Update content type breakdown
            const breakdownContainer = document.getElementById('contentTypeBreakdown');
            breakdownContainer.innerHTML = Object.entries(summary.topContentTypes).map(([type, count]) => `
                <div class="content-type-item">
                    <div class="content-type-name">${type}</div>
                    <div class="content-type-count">${count}</div>
                    <div class="content-type-percentage">${((count / summary.totalGenerations) * 100).toFixed(1)}%</div>
                </div>
            `).join('');
        }

        // Enhanced Campaign Functions
        function previewEmail() {
            const content = emailForceAI.editor ? 
                emailForceAI.editor.root.innerHTML : 
                document.getElementById('emailContentEditor').innerHTML;
            
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Email Preview</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                        .email-container { max-width: 600px; margin: 0 auto; }
                    </style>
                </head>
                <body>
                    <div class="email-container">
                        ${content}
                    </div>
                </body>
                </html>
            `);
            previewWindow.document.close();
        }

        // Enhanced A/B Testing Functions
        function createABTest() {
            const form = document.getElementById('abTestForm');
            const formData = new FormData(form);
            
            const testConfig = {
                name: form.querySelector('input[placeholder*="Test Name"]').value,
                type: form.querySelector('select').value,
                variants: {
                    variantA: form.querySelector('input[placeholder*="first variant"]').value,
                    variantB: form.querySelector('input[placeholder*="second variant"]').value
                },
                audience: document.getElementById('audienceSelect').value,
                splitPercentage: 50
            };
            
            if (testConfig.name && testConfig.variants.variantA && testConfig.variants.variantB) {
                emailForceAI.createABTest(testConfig);
                hideABTestModal();
                form.reset();
            } else {
                alert('Please fill in all required fields.');
            }
        }

        // Initialize enhanced features when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize rich text editor if Quill is available
            if (typeof Quill !== 'undefined') {
                const quill = new Quill('#emailContentEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'color': [] }, { 'background': [] }],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    },
                    placeholder: 'Start writing your email content...'
                });
                
                // Store the editor instance
                window.emailEditor = quill;
            }
            
            // Load any saved draft
            const draft = localStorage.getItem('emailDraft');
            if (draft && window.emailEditor) {
                window.emailEditor.root.innerHTML = draft;
            }
        });
    </script>
</body>
</html> 